#! /usr/bin/env node

var Docker = require('dockerode-promise');
var Consumer = require('../ironmq_consumer');
var program = require('commander');
var dockerOpts = require('dockerode-options');

function startWorker(queue, cmd) {
  var consumer = new Consumer({
    docker: new Docker(dockerOpts()),
    queue: queue
  });

  consumer.poll().then(
    null,
    function(err) {
      console.error('Epic fail');
      console.error(err.stack);
    }
  );
}

program.
  version(require('../package.json').version).
  command('start <queue>').
  option('--amqp <url>', 'full amqp url', 'amqp://guest:guest@127.0.0.1').
  description('bind worker to a particular amqp queue').
  action(startWorker);

program.parse(process.argv);
